# =============================================================================
# Piko Helm Chart - Example Production Values
# =============================================================================
#
# USAGE:
#   1. Copy this file: cp values-example.yaml my-values.yaml
#   2. Update the domains below to your actual domains
#   3. Create the JWT secret (see DEPLOYMENT.md)
#   4. Deploy: helm upgrade --install piko ./piko -n piko -f my-values.yaml
#
# =============================================================================

replicaCount: 3

# =============================================================================
# TLS - Using your existing cert-manager ClusterIssuer
# =============================================================================
tls:
  enabled: true
  certManager:
    enabled: true
    issuerName: "letsencrypt-prod"
    issuerKind: "ClusterIssuer"
    duration: 2160h
    renewBefore: 360h

# =============================================================================
# JWT Authentication
# =============================================================================
auth:
  enabled: true
  rsa:
    enabled: true
    existingSecret: "piko-jwt-rsa-public-key"
  proxy:
    enabled: true
    audience: "piko-proxy"
  upstream:
    enabled: true
    audience: "piko-upstream"
  admin:
    enabled: true
    audience: "piko-admin"

# =============================================================================
# Ingress Configuration
# =============================================================================
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
  baseDomain: "piko.example.com"
  services:
    - service1
    - service2
  users:
    - user1
    - user2
  proxy:
    enabled: true
    host: ""
    additionalHosts: []
    tls:
      enabled: true
  upstream:
    enabled: true
    host: ""
    additionalHosts: []
    tls:
      enabled: true
  admin:
    enabled: false
    host: ""
    tls:
      enabled: true
    annotations:
      nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8"

# =============================================================================
# Resources
# =============================================================================
resources:
  limits:
    cpu: 1000m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# =============================================================================
# High Availability
# =============================================================================
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: piko
          topologyKey: kubernetes.io/hostname

podDisruptionBudget:
  enabled: true
  minAvailable: 1
